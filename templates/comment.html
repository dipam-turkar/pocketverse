<div class="comment" data-comment-id="{{ comment.id }}">
    <div class="comment-voting">
        <button class="vote-btn upvote small" onclick="voteComment({{ comment.id }}, true)" title="Upvote">
            <span>▲</span>
        </button>
        <span class="vote-score" id="comment-vote-score-{{ comment.id }}">{{ comment.get_vote_score() }}</span>
        <button class="vote-btn downvote small" onclick="voteComment({{ comment.id }}, false)" title="Downvote">
            <span>▼</span>
        </button>
    </div>
    <div class="comment-body">
        <div class="comment-header">
            <span class="comment-author">
                {% if comment.author_user %}
                    {% if comment.author_user.is_official %}
                        <span class="official-badge">⭐ Official</span>
                    {% endif %}
                    <strong>{{ comment.author_user.display_name }}</strong>
                    {% if comment.author_user.is_official and comment.author_user.get_character_data() %}
                        {% set char_data = comment.author_user.get_character_data() %}
                        {% if char_data.get('show_name') %}
                            <span class="character-info">from <em>{{ char_data.show_name }}</em></span>
                        {% endif %}
                    {% endif %}
                {% else %}
                    {{ comment.get_author_name() }}
                {% endif %}
            </span>
            <span class="comment-date">{{ comment.created_at.strftime('%B %d, %Y at %I:%M %p') }}</span>
        </div>
        <div class="comment-content">
            <p>{{ comment.content }}</p>
        </div>
        {% if comment.replies %}
            <div class="replies">
                {% for reply in comment.replies %}
                    <div class="comment reply">
                        <div class="comment-voting">
                            <button class="vote-btn upvote small" onclick="voteComment({{ reply.id }}, true)" title="Upvote">
                                <span>▲</span>
                            </button>
                            <span class="vote-score" id="comment-vote-score-{{ reply.id }}">{{ reply.get_vote_score() }}</span>
                            <button class="vote-btn downvote small" onclick="voteComment({{ reply.id }}, false)" title="Downvote">
                                <span>▼</span>
                            </button>
                        </div>
                        <div class="comment-body">
                            <div class="comment-header">
                                <span class="comment-author">
                                    {% if reply.author_user %}
                                        {% if reply.author_user.is_official %}
                                            <span class="official-badge">⭐ Official</span>
                                        {% endif %}
                                        <strong>{{ reply.author_user.display_name }}</strong>
                                        {% if reply.author_user.is_official and reply.author_user.get_character_data() %}
                                            {% set char_data = reply.author_user.get_character_data() %}
                                            {% if char_data.get('show_name') %}
                                                <span class="character-info">from <em>{{ char_data.show_name }}</em></span>
                                            {% endif %}
                                        {% endif %}
                                    {% else %}
                                        {{ reply.get_author_name() }}
                                    {% endif %}
                                </span>
                                <span class="comment-date">{{ reply.created_at.strftime('%B %d, %Y at %I:%M %p') }}</span>
                            </div>
                            <div class="comment-content">
                                <p>{{ reply.content }}</p>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    </div>
</div>

